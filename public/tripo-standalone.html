<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tripo Standalone Model Viewer</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100vh;
      background-color: #000;
      color: white;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    #header {
      background-color: #000;
      padding: 10px;
      text-align: center;
      z-index: 10;
      border-bottom: 1px solid #333;
    }
    
    #viewer-container {
      flex: 1;
      position: relative;
    }
    
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background-color: #000;
    }
    
    #loading {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: rgba(0,0,0,0.9);
      z-index: 5;
    }
    
    #spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,255,255,0.2);
      border-radius: 50%;
      border-top-color: #06b6d4;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .button {
      background-color: #06b6d4;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      margin: 0 5px;
      cursor: pointer;
    }
    
    .button:hover {
      background-color: #0891b2;
    }
  </style>
</head>
<body>
  <div id="header">
    <h2>Tripo Model Viewer</h2>
    <div>
      <button class="button" id="refresh-btn">Refresh Viewer</button>
      <button class="button" id="open-new-btn">Open in New Window</button>
    </div>
  </div>
  
  <div id="viewer-container">
    <iframe id="viewer-frame" allowfullscreen="true"></iframe>
    
    <div id="loading">
      <div id="spinner"></div>
      <div id="loading-text">Loading model viewer...</div>
    </div>
  </div>

  <script>
    // Get elements
    const viewerFrame = document.getElementById('viewer-frame');
    const loading = document.getElementById('loading');
    const loadingText = document.getElementById('loading-text');
    const refreshBtn = document.getElementById('refresh-btn');
    const openNewBtn = document.getElementById('open-new-btn');
    
    // Get model URL from query string or use default
    const urlParams = new URLSearchParams(window.location.search);
    const modelUrl = urlParams.get('url') || 'https://tripo-data.rg1.data.tripo3d.com/tcli_9270104da6f34a46a2479869119b834d/20250401/54a290ed-d9c1-47b3-952b-979e71b019ff/tripo_base_model_54a290ed-d9c1-47b3-952b-979e71b019ff.glb?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6Ly90cmlwby1kYXRhLnJnMS5kYXRhLnRyaXBvM2QuY29tL3RjbGlfOTI3MDEwNGRhNmYzNGE0NmEyNDc5ODY5MTE5YjgzNGQvMjAyNTA0MDEvNTRhMjkwZWQtZDljMS00N2IzLTk1MmItOTc5ZTcxYjAxOWZmL3RyaXBvX2Jhc2VfbW9kZWxfNTRhMjkwZWQtZDljMS00N2IzLTk1MmItOTc5ZTcxYjAxOWZmLmdsYiIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTc0MzU1MjAwMH19fV19&Signature=Bsc~Lar0TB6Qz5sBQC4DUZi6bFK9uRK~B9lLZknXcNA-t9uyPHN5QO~o3tcb5~ogoLi3iTIrqc4Fbyj8Nur~mrFxayvDCLfMbiiGc4WLjR9o0zyjlDoEy1XmrH85cSLdo2pSgylkTLXB9dDN81mZXfTa7rxisHgqqm1u9OGnY0qQHrNYL4rl4lylefPKQUyDQj4CsQxJw7F8wwbBM1WRaD21L~TdfnrVMEThnOcbzhhquVxA~ABWvsIjcrxz4KcZoFx~HeqcFOL7z-wJyUNojAir-X88GpebbH1hilJUZLFilC~nThRniJYePwq9vuy~0guNXc62~sRbEFPZw2oGuQ__&Key-Pair-Id=K1676C64NMVM2J';
    
    // Generate the HTML content for a model viewer within an iframe
    function generateModelViewerHtml(url) {
      return `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Model Viewer</title>
          <style>
            body, html {
              margin: 0;
              padding: 0;
              width: 100%;
              height: 100%;
              overflow: hidden;
              background-color: #000;
            }
          </style>
          <!-- Google's model-viewer web component -->
          <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"><\/script>
        </head>
        <body>
          <!-- Simple model viewer with the source URL -->
          <model-viewer
            style="width: 100%; height: 100%;"
            src="${url}"
            camera-controls
            auto-rotate
            shadow-intensity="1"
            environment-image="neutral"
            exposure="0.8"
            crossorigin="anonymous"
          ></model-viewer>
        </body>
        </html>
      `;
    }
    
    // Initialize the iframe with data URL approach
    function initializeViewer() {
      loadingText.textContent = 'Preparing viewer...';
      
      // Create a data URL from the HTML content
      const htmlContent = generateModelViewerHtml(modelUrl);
      const dataUrl = 'data:text/html;charset=utf-8,' + encodeURIComponent(htmlContent);
      
      // Set the iframe src to the data URL
      viewerFrame.src = dataUrl;
      
      // Hide loading when iframe is loaded
      viewerFrame.onload = function() {
        loading.style.display = 'none';
      };
      
      // Set timeout as fallback
      setTimeout(() => {
        loading.style.display = 'none';
      }, 5000);
    }
    
    // Try using the direct-fetch HTML page
    function tryDirectFetch() {
      loadingText.textContent = 'Loading specialized viewer...';
      
      // Set the iframe to our direct fetch HTML
      viewerFrame.src = `/direct-fetch.html?url=${encodeURIComponent(modelUrl)}`;
      
      // Hide loading when iframe is loaded
      viewerFrame.onload = function() {
        loading.style.display = 'none';
      };
      
      // Set timeout as fallback
      setTimeout(() => {
        loading.style.display = 'none';
      }, 5000);
    }
    
    // Button event listeners
    refreshBtn.addEventListener('click', () => {
      loading.style.display = 'flex';
      loadingText.textContent = 'Refreshing viewer...';
      
      // Try a different approach each time
      if (viewerFrame.src.includes('data:text')) {
        tryDirectFetch();
      } else {
        initializeViewer();
      }
    });
    
    openNewBtn.addEventListener('click', () => {
      // Open direct-fetch in a new window
      window.open(`/direct-fetch.html?url=${encodeURIComponent(modelUrl)}`, '_blank');
    });
    
    // Start with direct fetch approach
    tryDirectFetch();
  </script>
</body>
</html> 